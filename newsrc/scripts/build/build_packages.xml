<?xml version="1.0" ?>
<!-- $Id$ -->
<project name="AEC" basedir="." default="build">
	<target name="build">
		<delete dir="${dir.packages}" />
		<mkdir dir="${dir.packages}" />

		<phing phingfile="build_component.xml" inheritRefs="true">
			<property file="properties/com.properties" override="true" />
		</phing>
		<phing phingfile="build_module.xml" inheritRefs="true">
			<property file="properties/module.properties" override="true" />
		</phing>
		<phing phingfile="build_plugin_access.xml" inheritRefs="true">
			<property file="properties/plugin_access.properties" override="true" />
		</phing>
		<phing phingfile="build_plugin_error.xml" inheritRefs="true">
			<property file="properties/plugin_error.properties" override="true" />
		</phing>
		<phing phingfile="build_plugin_routing.xml" inheritRefs="true">
			<property file="properties/plugin_routing.properties" override="true" />
		</phing>
		<phing phingfile="build_plugin_user.xml" inheritRefs="true">
			<property file="properties/plugin_user.properties" override="true" />
		</phing>

		<mkdir dir="${dir.packages}/packages" />
		<copy todir="${dir.packages}/packages" includeemptydirs="false">
			<fileset dir="${dir.packages}">
				<include name="*" />
			</fileset>
		</copy>

		<mkdir dir="${dir.packages}/plugins" />
		<copy todir="${dir.packages}/plugins">
			<fileset dir="${dir.packages}">
				<include name="plugin**" />
			</fileset>
		</copy>
		<delete>
			<fileset dir="${dir.packages}">
				<include name="plugin**" />
			</fileset>
		</delete>

		<mkdir dir="${dir.packages}/fullpack" />
		<copy todir="${dir.packages}/fullpack" includeemptydirs="false">
			<fileset dir="${dir.packages}">
				<exclude name="packages/" />
			</fileset>
		</copy>

		<copy todir="${dir.packages}/fullpack" includeemptydirs="false">
			<fileset dir="${dir.root}/../">
				<include name="README.txt" />
			</fileset>
		</copy>

		<delete dir="${dir.packages}/plugins" />
		<delete>
			<fileset dir="${dir.packages}">
				<include name="*acctexp*" />
			</fileset>
		</delete>

		<zip destfile="${dir.packages}/${file.dist_package}_${file.dist_version}_rev${git.lastrevision}_${file.extensionsafe}_UNZIP_FIRST.zip" basedir="${dir.packages}/fullpack" />

		<delete dir="${dir.packages}/fullpack" />

		<delete dir="${dir.dropbox}/${file.extension}" />
		<mkdir dir="${dir.dropbox}/${file.extension}" />

		<copy todir="${dir.dropbox}/${file.extension}" includeemptydirs="false">
			<fileset dir="${dir.packages}">
				<include name="*.*" />
			</fileset>
		</copy>

		<mkdir dir="${dir.dropbox}/${file.extension}/packages" />
		<copy todir="${dir.dropbox}/${file.extension}/packages" includeemptydirs="false">
			<fileset dir="${dir.packages}/packages">
				<include name="*.*" />
			</fileset>
		</copy>

	</target>
</project>